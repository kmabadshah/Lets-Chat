{"version":3,"sources":["webpack:///./node_modules/@hookform/error-message/dist/index.esm.js","webpack:///./src/components/layout.js","webpack:///./src/pages/settings.js"],"names":["o","_o","m","as","f","errors","i","name","u","message","c","render","g","r","e","s","n","a","t","Object","keys","length","indexOf","l","d","p","v","types","h","assign","children","messages","Layout","style","id","to","Settings","React","useState","editing","setEditing","useContext","Context","user","setUser","token","socket","setConnectedUsers","useForm","handleSubmit","reset","setError","register","blurStyle","filter","pointerEvents","useEffect","on","updatedUser","off","onAddFriend","axios","qs","alreadyFriend","friends","find","uname","get","api","stringify","_where","headers","Authorization","data","type","currentUser","push","messagesSentToMe","messagesSentByMe","dontUpdate","onChangeUname","onChangePass","current_pass","pass","new_pass","conf_pass","onClick","icon","faUserPlus","faPen","localStorage","removeItem","navigate","faLongArrowAltRight","onSubmit","placeholder","ref","required","fontSize","color","loader"],"mappings":"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","file":"component---src-pages-settings-js-6cb1b1e6c7bef4a3ecb5.js","sourcesContent":["import { isValidElement as r, cloneElement as e, createElement as s, Fragment as n } from \"react\";\nimport { useFormContext as a, get as t } from \"react-hook-form\";\n\nvar o = function o(_o) {\n  var m = _o.as,\n      f = _o.errors,\n      i = _o.name,\n      u = _o.message,\n      c = _o.render,\n      g = function (r, e) {\n    if (null == r) return {};\n    var s,\n        n,\n        a = {},\n        t = Object.keys(r);\n\n    for (n = 0; n < t.length; n++) {\n      e.indexOf(s = t[n]) >= 0 || (a[s] = r[s]);\n    }\n\n    return a;\n  }(_o, [\"as\", \"errors\", \"name\", \"message\", \"render\"]),\n      l = a(),\n      d = t(f || l.errors, i);\n\n  if (!d) return null;\n  var p = d.message,\n      v = d.types,\n      h = Object.assign({}, g, {\n    children: p || u\n  });\n  return r(m) ? e(m, h) : c ? c({\n    message: p || u,\n    messages: v\n  }) : s(m || n, h);\n};\n\nexport { o as ErrorMessage };","import React, {useState} from 'react'\nimport { Link } from 'gatsby'\n\nfunction Layout({ children, style }){\n\treturn(\n\t\t<div id='layout' style={style}>\n\t\t\t<div id='navbar'>\n\t\t\t\t<Link to='/'>Home</Link>\n\t\t\t\t<Link to='/settings'>Settings</Link>\n\t\t\t</div>\n\t\t\t{ children }\n\t\t</div>\n\t)\n}\n\nexport default Layout\n","import React, {useState} from \"react\"\nimport Layout from '../components/layout'\nimport { Context } from '../components/wrapper'\nimport { api, loader } from '../shared/constants'\nimport { navigate } from 'gatsby'\nimport { useForm } from 'react-hook-form'\nimport { ErrorMessage } from '@hookform/error-message'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faUserPlus, faPen, faLongArrowAltRight } from '@fortawesome/free-solid-svg-icons'\n// import { faCheckCircle, faSmile, faClock } from '@fortawesome/free-regular-svg-icons'\n\nfunction Settings(){\n\tconst [editing, setEditing] = React.useState()\n\tconst { user, setUser, token, socket, setConnectedUsers } = React.useContext(Context)\n\tconst { handleSubmit, reset, errors, setError, register } = useForm()\n\tconst blurStyle = {\n\t\tfilter: editing && 'blur(5px)',\n\t\tpointerEvents: editing && 'none'\n\t}\n\n\tReact.useEffect(() => {\n\t\tsocket.on('connectedUsers', (d) => setConnectedUsers(d))\n\t\tsocket.on('message', updatedUser => {\n\t\t\tsetUser(updatedUser)\n\t\t})\n\t\tsocket.on('entering', updatedUser => setUser(updatedUser))\n\n\t\treturn () => socket.off()\n\t}, [])\n\n\tconst onAddFriend = async (d) => {\n\t\tconst axios = await import('axios')\n\t\tconst qs = await import('qs')\n\n\t\t// check if already friend\n\t\tconst alreadyFriend = user.friends.find(f => f.uname === d.uname)\n\t\t// check if friend exists as a user\n\t\tconst res = await axios.get(api + '/chatters?' + qs.stringify({\n\t\t\t_where: { uname: d.uname }\n\t\t}), { headers: { Authorization: `Bearer ${token}` } })\n\n\t\tif (!res.data[0]) {\n\t\t\tsetError('uname', { type: 'random', message: `User doesn't exist` })\n\t\t} else if (alreadyFriend) {\n\t\t\tsetError('uname', { type: 'random', message: `He is already your friend` })\n\t\t} else if (d.uname === user.uname) {\n\t\t\tsetError('uname', { type: 'random', message: `That's your own username` })\n\t\t} else {\n\t\t\tsetUser(currentUser => {\n\t\t\t\tcurrentUser.friends.push({ uname: d.uname, messagesSentToMe: [], messagesSentByMe: [] })\n\t\t\t\treturn { ...currentUser, dontUpdate: false }\n\t\t\t})\n\n\n\t\t\tsetEditing(false)\n\t\t}\n\n\t}\n\n\tconst onChangeUname = async (d) => {\n\t\tconst axios = await import('axios')\n\t\tconst qs = await import('qs')\n\n\t\t// check if the uname exists\n\t\tconst res = await axios.get(api + '/chatters?' + qs.stringify({\n\t\t\t_where: { uname: d.uname }\n\t\t}), { headers: { Authorization: `Bearer ${token}` } })\n\n\t\tif (res.data[0]) {\n\t\t\tsetError('uname', { type: 'random', message: `Please choose a different username` })\n\t\t} else {\n\t\t\tsetUser(currentUser => {\n\t\t\t\treturn { ...currentUser, uname: d.uname, dontUpdate: false }\n\t\t\t})\n\n\t\t\tsetEditing(false)\n\t\t}\n\n\t}\n\n\tconst onChangePass = (d) => {\n\t\tif (d.current_pass !== user.pass) {\n\t\t\tsetError('current_pass', { type: 'random', message: `Invalid password` })\n\t\t} else if (d.new_pass !== d.conf_pass){\n\t\t\tsetError('conf_pass', { type: 'random', message: `Passwords don't match` })\n\t\t} else {\n\t\t\tsetUser(currentUser => {\n\t\t\t\treturn { ...currentUser, pass: d.new_pass, dontUpdate: false }\n\t\t\t})\n\n\t\t\tsetEditing(false)\n\t\t}\n\n\t}\n\n\tconst logOut = () => {\n\t\t// remove data from cache\n\t\tlocalStorage.removeItem('token')\n\n\t\t// redirect to login\n\t\tnavigate('/login')\n\t}\n\n\treturn !user ? loader : (\n\t\t<Layout>\n\t\t\t<div id='settings'>\n\t\t\t\t<button onClick={() => setEditing('add-friend')} style={blurStyle}>\n\t\t\t\t\t<h3>Add a friend</h3>\n\t\t\t\t\t<FontAwesomeIcon icon={ faUserPlus } />\n\t\t\t\t</button>\n\t\t\t\t<div style={blurStyle}>\n\t\t\t\t\t<h3>Username</h3>\n\t\t\t\t\t<h3>{user.uname}</h3>\n\t\t\t\t\t<FontAwesomeIcon icon={ faPen } onClick={() => setEditing('uname')} />\n\t\t\t\t</div>\n\t\t\t\t<div style={blurStyle}>\n\t\t\t\t\t<h3>Password</h3>\n\t\t\t\t\t<h3>**********</h3>\n\t\t\t\t\t<FontAwesomeIcon icon={ faPen } onClick={() => setEditing('pass')} />\n\t\t\t\t</div>\n\t\t\t\t<button style={blurStyle} onClick={() => setUser(null) & localStorage.removeItem('token') &  navigate('/login')}>\n\t\t\t\t\t<h3>Logout</h3>\n\t\t\t\t\t<FontAwesomeIcon icon={ faLongArrowAltRight } />\n\t\t\t\t</button>\n\n\t\t\t\t{(() => {\n\t\t\t\t\tswitch (editing) {\n\t\t\t\t\t\tcase 'add-friend': {\n\t\t\t\t\t\t\treturn (<form onSubmit={handleSubmit(onAddFriend)}>\n\t\t\t\t\t\t\t\t<input name='uname' placeholder='John Doe' ref={register({ required: true })} />\n\t\t\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\t\t\tname='uname'\n\t\t\t\t\t\t\t\t\tstyle={{fontSize: '0.75rem', color: '#EF7B6C'}}\n\t\t\t\t\t\t\t\t\tas='p'\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<button type='submit'> Submit </button>\n\t\t\t\t\t\t\t\t<button onClick={() => setEditing(false)}> Cancel </button>\n\t\t\t\t\t\t\t</form>)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'uname': {\n\t\t\t\t\t\t\treturn (<form onSubmit={handleSubmit(onChangeUname)}>\n\t\t\t\t\t\t\t\t<input name='uname' placeholder='New Username' ref={register({ required: true })} />\n\n\t\t\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\t\t\tname='uname'\n\t\t\t\t\t\t\t\t\tstyle={{fontSize: '0.75rem', color: '#EF7B6C'}}\n\t\t\t\t\t\t\t\t\tas='p'\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<button type='submit'> Submit </button>\n\t\t\t\t\t\t\t\t<button onClick={() => setEditing(false)}> Cancel </button>\n\t\t\t\t\t\t\t</form>)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'pass': {\n\t\t\t\t\t\t\treturn (<form onSubmit={handleSubmit(onChangePass)}>\n\t\t\t\t\t\t\t\t<input name='current_pass' placeholder='Current Password' ref={register({ required: true })} />\n\t\t\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\t\t\tname='current_pass'\n\t\t\t\t\t\t\t\t\tstyle={{fontSize: '0.75rem', color: '#EF7B6C'}}\n\t\t\t\t\t\t\t\t\tas='p' />\n\n\n\t\t\t\t\t\t\t\t<input name='new_pass' placeholder='New Password' ref={register({ required: true })} />\n\t\t\t\t\t\t\t\t<input name='conf_pass' placeholder='Confirm Password' ref={register({ required: true })} />\n\t\t\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\t\t\tname='conf_pass'\n\t\t\t\t\t\t\t\t\tstyle={{fontSize: '0.75rem', color: '#EF7B6C'}}\n\t\t\t\t\t\t\t\t\tas='p' />\n\n\t\t\t\t\t\t\t\t<button type='submit'> Submit </button>\n\t\t\t\t\t\t\t\t<button onClick={() => setEditing(false)}> Cancel </button>\n\t\t\t\t\t\t\t</form>)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})()}\n\t\t\t</div>\n\t\t</Layout>\n\t)\n}\n\nexport default Settings\n"],"sourceRoot":""}
(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{QQwb:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var a=n("q1tI"),r=n.n(a),c=n("Xj0o"),s=n("Wbzz"),u=n("bfiW"),i=n("NKCw"),o=n("IP2g"),l=n("wHSu"),m={prefix:"far",iconName:"check-circle",icon:[512,512,[],"f058","M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 48c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m140.204 130.267l-22.536-22.718c-4.667-4.705-12.265-4.736-16.97-.068L215.346 303.697l-59.792-60.277c-4.667-4.705-12.265-4.736-16.97-.069l-22.719 22.536c-4.705 4.667-4.736 12.265-.068 16.971l90.781 91.516c4.667 4.705 12.265 4.736 16.97.068l172.589-171.204c4.704-4.668 4.734-12.266.067-16.971z"]},f={prefix:"far",iconName:"clock",icon:[512,512,[],"f017","M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"]},d={prefix:"far",iconName:"smile",icon:[496,512,[],"f118","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z"]},g=n("vDqi"),E=n.n(g);function w(){var e=r.a.useContext(c.Context),t=e.user,n=e.setUser,g=e.friendIndex,w=e.socket,p=e.token,v=e.connectedUsers,h=e.setConnectedUsers,b=Object(i.b)(),S=b.register,D=b.handleSubmit,M=b.reset,_=Object(a.useState)(),k=(_[0],_[1]),C=Object(a.useState)(!1),z=C[0],y=C[1],j=Object(a.useState)(),x=j[0],N=j[1],O=Object(a.useState)([]),L=O[0],I=O[1],T=r.a.useRef(),U=t.friends[g],A="";Array.from({length:Math.ceil(L.length/4)},(function(){return A+="10% "})),r.a.useEffect((function(){k((function(){return!v.find((function(e){return e.uname===U.uname}))}))}),[v]),r.a.useEffect((function(){return E.a.get(u.c).then((function(e){return I(e.data)})).catch((function(e){return console.log(e)})),w.on("connectedUsers",(function(e){return h(e)})),w.on("message",(function(e){n((function(e){var t=e.friends.find((function(e){return e.uname===U.uname})).messagesSentToMe;return t=t.filter((function(e){return e.status="seen"})),Object.assign({},e,{dontUpdate:!1})})),n(e),T.current.scrollIntoView()})),w.on("entering",(function(e){return n(e)})),function(){w.emit("leaving"),w.off()}}),[]),r.a.useLayoutEffect((function(){T.current.scrollIntoView()}),[]);var V;return r.a.createElement("div",{id:"chat"},r.a.createElement("div",{id:"top"},r.a.createElement(o.a,{className:"btn-back",onClick:function(){return Object(s.c)("/")},icon:l.a}),r.a.createElement("h2",null,U.uname)),r.a.createElement("div",{id:"middle"},(V=[],t.friends[g].messagesSentToMe.forEach((function(e){var t=q(e);V.push({view:r.a.createElement("div",{className:"msg-received-row"},r.a.createElement("div",null,r.a.createElement("p",null,e.text)),r.a.createElement("div",null,r.a.createElement("p",null,t&&t.date),r.a.createElement("p",null,t&&t.hourAndMinute))),sent_at:new Date(e.sent_at).getTime()})})),t.friends[g].messagesSentByMe.forEach((function(e){var t=q(e);V.push({view:r.a.createElement("div",{className:"msg-sent-row"},t?r.a.createElement("div",null,r.a.createElement("p",null,t&&t.date),r.a.createElement("p",null,t&&t.hourAndMinute)):r.a.createElement("div",null),r.a.createElement("div",null,r.a.createElement(o.a,{icon:function(){switch(e.status){case"sending":return f;case"sent":return m;case"seen":return l.c}}(),className:"check-circle"}),r.a.createElement("p",null,e.text))),sent_at:new Date(e.sent_at).getTime()})})),V.sort((function(e,t){return e.sent_at-t.sent_at})).map((function(e){return e.view}))),r.a.createElement("div",{ref:T})),r.a.createElement("form",{id:"bottom",autoComplete:"off",onSubmit:D((function(e){N(!0),n((function(t){return t.friends.find((function(e){return e.uname===U.uname})).messagesSentByMe.push({text:e.msg,sent_at:Date.now(),status:"sending"}),Object.assign({},t,{dontUpdate:!0})})),w.emit("message",e.msg,U.uname,p,(function(e){n(e),N(!1)})),T.current.scrollIntoView(),M()})),style:{pointerEvents:x?"none":"auto",backgroundColor:x&&"#999",borderColor:x&&"#999"}},r.a.createElement(o.a,{icon:d,onClick:function(){return y(!z)}}),r.a.createElement("input",{autoComplete:"false",name:"msg",disabled:x,ref:S({required:!0})}),r.a.createElement("button",{type:"submit"},r.a.createElement(o.a,{icon:l.b}))),z&&r.a.createElement("div",{id:"picker",style:{gridTemplateColumns:A}},L.map((function(e){return r.a.createElement("div",null,e.character)}))));function q(e){return e.sent_at?{get date(){var t=(new Date).getDate(),n=(new Date).getMonth(),a=(new Date).getFullYear(),r=new Date(e.sent_at).getDate(),c=new Date(e.sent_at).getMonth(),s=new Date(e.sent_at).toLocaleString("default",{month:"long"}),u=new Date(e.sent_at).getFullYear();return a!==u?r+"th "+s+", "+u:c!==n?n-c==1?"Last Month":r+"th "+s:t===r?"Today":t-r==1?"Yesterday":t-r<7?new Date(e.sent_at).toLocaleString("en",{weekday:"long"}):t-r>=7&&t-r<14?"Last Week":void 0},get hourAndMinute(){var t=new Date(e.sent_at).getHours(),n=new Date(e.sent_at).getMinutes(),a=":";return n<10?a=a+0+n:a+=n,a=t>12?t-12+a+" pm":t+a+" am"}}:null}}}}]);
//# sourceMappingURL=component---src-pages-chat-js-ff470d2fd4cdf860b58a.js.map
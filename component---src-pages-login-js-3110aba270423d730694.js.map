{"version":3,"sources":["webpack:///./node_modules/@hookform/error-message/dist/index.esm.js","webpack:///./src/pages/login.js"],"names":["o","_o","m","as","f","errors","i","name","u","message","c","render","g","r","e","s","n","a","t","Object","keys","length","indexOf","l","d","p","v","types","h","assign","children","messages","Login","React","useContext","Context","token","isLoading","setUser","useForm","handleSubmit","reset","setError","register","onSubmit","axios","qs","jwtpkg","get","api","stringify","_where","uname","pass","headers","Authorization","res","data","sign","secret","err","jwt","console","log","localStorage","setItem","navigate","type","useEffect","id","autoComplete","placeholder","ref","required","style","fontSize","marginTop","color","value","to"],"mappings":"8FAAA,8DAGIA,EAAI,SAAWC,GACjB,IAAIC,EAAID,EAAGE,GACPC,EAAIH,EAAGI,OACPC,EAAIL,EAAGM,KACPC,EAAIP,EAAGQ,QACPC,EAAIT,EAAGU,OACPC,EAAI,SAAUC,EAAGC,GACnB,GAAI,MAAQD,EAAG,MAAO,GACtB,IAAIE,EACAC,EACAC,EAAI,GACJC,EAAIC,OAAOC,KAAKP,GAEpB,IAAKG,EAAI,EAAGA,EAAIE,EAAEG,OAAQL,IACxBF,EAAEQ,QAAQP,EAAIG,EAAEF,KAAO,IAAMC,EAAEF,GAAKF,EAAEE,IAGxC,OAAOE,EAXD,CAYNhB,EAAI,CAAC,KAAM,SAAU,OAAQ,UAAW,WACtCsB,EAAI,cACJC,EAAI,YAAEpB,GAAKmB,EAAElB,OAAQC,GAEzB,IAAKkB,EAAG,OAAO,KACf,IAAIC,EAAID,EAAEf,QACNiB,EAAIF,EAAEG,MACNC,EAAIT,OAAOU,OAAO,GAAIjB,EAAG,CAC3BkB,SAAUL,GAAKjB,IAEjB,OAAO,yBAAEN,GAAK,uBAAEA,EAAG0B,GAAKlB,EAAIA,EAAE,CAC5BD,QAASgB,GAAKjB,EACduB,SAAUL,IACP,wBAAExB,GAAK,WAAG0B,K,mNC3BF,SAASI,IAAQ,IAAD,EACWC,IAAMC,WAAWC,WAApCC,GADQ,EACnBC,UADmB,EACRD,OAAOE,EADC,EACDA,QADC,EAEiCC,cAApDC,EAFmB,EAEnBA,aAAqBnC,GAFF,EAELoC,MAFK,EAEEpC,QAAQqC,EAFV,EAEUA,SAAUC,EAFpB,EAEoBA,SAEzCC,EAAQ,uCAAG,WAAOpB,GAAP,qBAAAP,EAAA,sEACO,gDADP,cACP4B,EADO,gBAEK,qCAFL,cAEPC,EAFO,gBAGQ,gDAHR,cAGPC,EAHO,iBAMKF,EAAMG,IAAIC,IAAI,aAAaH,EAAGI,UAAU,CACtDC,OAAQ,CAAEC,MAAO5B,EAAE4B,MAAOC,KAAM7B,EAAE6B,QAClC,CAAEC,QAAS,CAAEC,cAAc,UAAWnB,KAR7B,SAMPoB,EANO,QAUJC,KAAK,IAGVnB,EAAQkB,EAAIC,KAAK,IAEjBV,EAAOW,KAAK,CAAEN,MAAO5B,EAAE4B,OAASO,KAAQ,SAACC,EAAKC,GAC1CD,EAAME,QAAQC,IAAIH,GACdI,aAAaC,QAAQ,QAASJ,MAGtCK,YAAS,MATTxB,EAAS,QAAS,CAAEyB,KAAM,SAAU1D,QAAQ,iCAXnC,4CAAH,sDA4Bd,OAJAwB,IAAMmC,WAAU,WACZN,QAAQC,IAAI,WACb,IAGC,yBAAKM,GAAG,SACJ,0BAAMC,aAAa,MAAM1B,SAAUJ,EAAaI,IAC5C,0CAEA,2BAAOrC,KAAK,QAAQ+D,aAAa,QAAQC,YAAY,WAAWC,IAAK7B,EAAS,CAC1E8B,UAAU,MAEd,kBAAC,IAAD,CACIpE,OAAQA,EACRE,KAAK,QACLmE,MAAO,CAACC,SAAU,UAAWC,UAAW,UAAWC,MAAO,WAC1D1E,GAAG,MAGP,2BAAOI,KAAK,OAAO4D,KAAK,WAAWG,aAAa,QAAQC,YAAY,WAChEC,IAAK7B,EAAS,CACV8B,UAAU,MAGlB,6BACI,2BAAON,KAAK,SAASW,MAAM,UAC3B,kBAAC,IAAD,CAAMC,GAAG,WAAT","file":"component---src-pages-login-js-3110aba270423d730694.js","sourcesContent":["import { isValidElement as r, cloneElement as e, createElement as s, Fragment as n } from \"react\";\nimport { useFormContext as a, get as t } from \"react-hook-form\";\n\nvar o = function o(_o) {\n  var m = _o.as,\n      f = _o.errors,\n      i = _o.name,\n      u = _o.message,\n      c = _o.render,\n      g = function (r, e) {\n    if (null == r) return {};\n    var s,\n        n,\n        a = {},\n        t = Object.keys(r);\n\n    for (n = 0; n < t.length; n++) {\n      e.indexOf(s = t[n]) >= 0 || (a[s] = r[s]);\n    }\n\n    return a;\n  }(_o, [\"as\", \"errors\", \"name\", \"message\", \"render\"]),\n      l = a(),\n      d = t(f || l.errors, i);\n\n  if (!d) return null;\n  var p = d.message,\n      v = d.types,\n      h = Object.assign({}, g, {\n    children: p || u\n  });\n  return r(m) ? e(m, h) : c ? c({\n    message: p || u,\n    messages: v\n  }) : s(m || n, h);\n};\n\nexport { o as ErrorMessage };","import React, {useState} from \"react\"\nimport { loader, api, secret } from \"../shared/constants\"\nimport { Context } from \"../components/wrapper\"\nimport { navigate, Link } from \"gatsby\"\nimport { ErrorMessage } from '@hookform/error-message'\nimport { useForm } from \"react-hook-form\"\n\nexport default function Login(){\n    const { isLoading, token, setUser } = React.useContext(Context)\n    const { handleSubmit, reset, errors, setError, register } = useForm()\n\n    const onSubmit = async (d) => {\n        const axios = await import('axios')\n        const qs = await  import('qs')\n        const jwtpkg = await import('jsonwebtoken')\n\n        // data -> db check\n        const res = await axios.get(api+'/chatters?'+qs.stringify({\n            _where: { uname: d.uname, pass: d.pass }\n        }), { headers: { Authorization: `Bearer ${token}` } })\n\n        if (!res.data[0]) {\n            setError('uname', { type: 'random', message: `Invalid username or password` })\n        } else {\n            setUser(res.data[0])\n            // create token with user data and store into cache\n            jwtpkg.sign({ uname: d.uname }, secret, (err, jwt) => {\n                err ? console.log(err) :\n                    localStorage.setItem('token', jwt)\n            })\n            // redirect\n            navigate('/')\n        }\n    }\n\n    React.useEffect(() => {\n        console.log('login')\n    }, [])\n\n    return (\n        <div id='login'>\n            <form autoComplete='off' onSubmit={handleSubmit(onSubmit)}>\n                <h1>Let's Chat</h1>\n\n                <input name=\"uname\" autoComplete=\"false\" placeholder=\"Username\" ref={register({\n                    required: true\n                })} />\n                <ErrorMessage\n                    errors={errors}\n                    name='uname'\n                    style={{fontSize: '0.75rem', marginTop: '0.25rem', color: '#EF7B6C'}}\n                    as='p'\n                />\n\n                <input name=\"pass\" type=\"password\" autoComplete=\"false\" placeholder=\"Password\"\n                    ref={register({\n                        required: true\n                    })} />\n\n                <div>\n                    <input type=\"submit\" value=\"Login\" />\n                    <Link to='/signup'>Sign Up</Link>\n                </div>\n            </form>\n        </div>\n    )\n}\n\n"],"sourceRoot":""}